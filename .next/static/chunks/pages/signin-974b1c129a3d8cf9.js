(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2176],{81335:function(t,e,n){"use strict";n.d(e,{S:function(){return SigninContainer},u:function(){return useRedirect}});var i=n(25445),a=n(51511),u=n(2784);let SigninContainer=({children:t,title:e})=>{let{colors:n,shadow:u}=(0,i.Fg)();return(0,i.tZ)("div",null,(0,i.tZ)(a.Fb,null,(0,i.tZ)("title",null,e||"Keystone")),(0,i.tZ)(i.M5,{css:{minWidth:"100vw",minHeight:"100vh",backgroundColor:n.backgroundMuted},rounding:"medium"},(0,i.tZ)(i.xu,{css:{background:n.background,width:600,boxShadow:u.s100},margin:"medium",padding:"xlarge",rounding:"medium"},t)))};function useRedirect(){return(0,u.useMemo)(()=>"/",[])}},24176:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signin",function(){return n(40633)}])},40633:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return h}});var i,a=n(2784),u=n(25445),r=n(25631),s=n(2445),o=n(43900),d=n(10081),l=n(1804),c=n(64338),g=n(51511),m=n(81335);function SigninPage({identityField:t,secretField:e,mutationName:n,successTypename:i,failureTypename:h}){var v,f;let p=d.Ps`
    mutation($identity: String!, $secret: String!) {
      authenticate: ${n}(${t}: $identity, ${e}: $secret) {
        ... on ${i} {
          item {
            id
          }
        }
        ... on ${h} {
          message
        }
      }
    }
  `,[w,y]=(0,a.useState)("signin"),[Z,S]=(0,a.useState)({identity:"",secret:""}),[b,_]=(0,a.useState)(!1),k=(0,a.useRef)(null);(0,a.useEffect)(()=>{var t;null===(t=k.current)||void 0===t||t.focus()},[w]);let[E,{error:$,loading:C,data:F}]=(0,l.D)(p),P=(0,c.Mz)(),x=(0,g.tv)(),q=(0,c.gS)(),K=(0,m.u)();(0,a.useEffect)(()=>{b||"authenticated"!==q.authenticatedItem.state||x.push(K)},[q.authenticatedItem,x,K,b]),(0,a.useEffect)(()=>{var t;if(b){if((null===(t=q.adminMeta)||void 0===t||null===(t=t.error)||void 0===t?void 0:t.message)==="Access denied"){x.push("/no-access");return}x.push(K)}},[q.adminMeta,x,K,b]);let onSubmit=async t=>{if(t.preventDefault(),"signin"===w){try{var e;let{data:t}=await E({variables:{identity:Z.identity,secret:Z.secret}});if((null===(e=t.authenticate)||void 0===e?void 0:e.__typename)!==i)return}catch(t){console.error(t);return}await P(),_(!0)}};return(0,u.tZ)(m.S,{title:"Keystone - Sign in"},(0,u.tZ)(u.Kq,{gap:"xlarge",as:"form",onSubmit:onSubmit},(0,u.tZ)(u.H1,null,"Sign In"),$&&(0,u.tZ)(o.qX,{title:"Error",tone:"negative"},$.message),(null==F||null===(v=F.authenticate)||void 0===v?void 0:v.__typename)===h&&(0,u.tZ)(o.qX,{title:"Error",tone:"negative"},null==F?void 0:F.authenticate.message),(0,u.tZ)(u.Kq,{gap:"medium"},(0,u.tZ)(u.TX,{as:"label",htmlFor:"identity"},t),(0,u.tZ)(s.oi,{id:"identity",name:"identity",value:Z.identity,onChange:t=>S({...Z,identity:t.target.value}),placeholder:t,ref:k}),"signin"===w&&(0,u.tZ)(a.Fragment,null,(0,u.tZ)(u.TX,{as:"label",htmlFor:"password"},e),(0,u.tZ)(s.oi,{id:"password",name:"password",value:Z.secret,onChange:t=>S({...Z,secret:t.target.value}),placeholder:e,type:"password"}))),"forgot password"===w?(0,u.tZ)(u.Kq,{gap:"medium",across:!0},(0,u.tZ)(r.zx,{type:"submit",weight:"bold",tone:"active"},"Log reset link"),(0,u.tZ)(r.zx,{weight:"none",tone:"active",onClick:()=>y("signin")},"Go back")):(0,u.tZ)(u.Kq,{gap:"medium",across:!0},(0,u.tZ)(r.zx,{weight:"bold",tone:"active",isLoading:C||(null==F||null===(f=F.authenticate)||void 0===f?void 0:f.__typename)===i,type:"submit"},"Sign in"))))}var h=(i={identityField:"email",secretField:"password",mutationName:"authenticateUserWithPassword",successTypename:"UserAuthenticationWithPasswordSuccess",failureTypename:"UserAuthenticationWithPasswordFailure"},()=>(0,u.tZ)(SigninPage,i))}},function(t){t.O(0,[9774,2888,179],function(){return t(t.s=24176)}),_N_E=t.O()}]);